[id="ocp-4-4-release-notes"]
= {product-title} {product-version} release notes
include::modules/common-attributes.adoc[]
:context: release-notes

toc::[]

Red Hat {product-title} provides developers and IT organizations with a hybrid
cloud application platform for deploying both new and existing applications on
secure, scalable resources with minimal configuration and management overhead.
{product-title} supports a wide selection of programming languages and
frameworks, such as Java, JavaScript, Python, Ruby, and PHP.

Built on Red Hat Enterprise Linux and Kubernetes, {product-title}
provides a more secure and scalable multi-tenant operating system for today’s
enterprise-class applications, while delivering integrated application runtimes
and libraries. {product-title} enables organizations to meet security, privacy,
compliance, and governance requirements.

[id="ocp-4-4-about-this-release"]
== About this release

// Copied from 4.3; update when more information is available.

Red Hat {product-title}
(link:https://access.redhat.com/errata/RHBA-2020:1234[RHBA-2020:1234]) is now
available. This release uses link:https://v1-17.docs.kubernetes.io/docs/setup/release/notes/[Kubernetes 1.17] with CRI-O runtime. New features, changes, and known issues that pertain to
{product-title} {product-version} are included in this topic.

{product-title} {product-version} clusters are available at
https://cloud.redhat.com/openshift. The {cloud-redhat-com}
application for {product-title} allows you to deploy OpenShift clusters to
either on-premise or cloud environments.

{product-title} {product-version} is supported on Red Hat Enterprise Linux 7.6 or
later, as well as Red Hat Enterprise Linux CoreOS 4.3.

You must use {op-system-first} for the control plane, or master, machines and
can use either {op-system} or Red Hat Enterprise Linux 7.6 or later for
compute, or worker, machines.

[IMPORTANT]
====
Because only Red Hat Enterprise Linux version 7.6 or later is supported for compute
machines, you must not upgrade the Red Hat Enterprise Linux compute machines to
version 8.
====

[id="ocp-4-4-new-features-and-enhancements"]
== New features and enhancements

This release adds improvements related to the following components and concepts.

[id="ocp-4-4-installation-and-upgrade"]
=== Installation and upgrade

[id="ocp-4-4-installing-cluster-on-azure-upi"]
==== Installing a cluster on Microsoft Azure using user-provisioned infrastructure

{product-title} 4.4 introduces support for installing a cluster on Azure using
user-provisioned infrastructure. Running user-provisioned infrastructure on
Azure lets you use customizations your environment might require, like
regulatory, security, and operational control.

You can incorporate example Azure Resource Manager (ARM) templates provided by
Red Hat to assist in the deployment process, or create your own. You are also
free to create the required resources through other methods; the ARM templates
are just an example.

See xref:../installing/installing_azure/installing-azure-user-infra.adoc#installing-azure-user-infra[Installing a cluster on Azure using ARM templates]
for details.

[id="ocp-4-4-security"]
=== Security

[id="ocp-4-4-kube-apiserver-check-certs-before-tokens"]
==== kube-apiserver checks client certificates before tokens

In previous versions of {product-title}, the kube-apiserver checked tokens
before client certificates for authentication. Now kube-apiserver checks client
certificates before tokens.

For example, if you had a `system:admin` kubeconfig and ran the `oc --token=foo get pod`
command in previous versions of {product-title}, it would authenticate as a user
with token `foo`. Now it authenticates as `system:admin`. The recommendation for
past releases was to impersonate a user with the parameter `--as` in such cases
instead of overriding the token when using a client certificate; this is no
longer necessary.

[id="ocp-4-4-nodes"]
=== Nodes

[id="ocp-4-4-evicting-pods-using-descheduler-tp"]
==== Evicting Pods using the descheduler (Technology Preview)

The descheduler provides the ability to evict a running Pod so that the Pod can
be rescheduled onto a more suitable node.

You can benefit from descheduling Pods in situations such as the following:

* Nodes are underutilized or overutilized.
* Pod and node affinity requirements, such as taints or labels, have changed and
the original scheduling decisions are no longer appropriate for certain nodes.
* Node failure requires Pods to be moved.
* New nodes are added to clusters.

See xref:../nodes/scheduling/nodes-descheduler.adoc#nodes-descheduler[Evicting Pods using the descheduler]
for more information.

[id="ocp-4-4-logging"]
=== Logging

[id="ocp-4-4-sending-cluster-logs-using-fluent-syslog-plug-in"]
==== Sending cluster logs using the Fluentd syslog plug-in (RFC 3164)

Due to changes introduced with the Log Forwarding feature in {product-title}
4.3, you could no longer use the Fluentd syslog plug-in to forward logs to an
external syslog server. In {product-title} 4.4, this functionality is restored
and you can use the syslog plug-in. The procedure to configure the plug-in is
different in {product-title} version 4.4 than it was in version 4.2. For more
information, see
xref:../logging/config/cluster-logging-external.adoc#cluster-logging-collector-syslog_cluster-logging-external[Sending logs using the Fluentd syslog plug-in (RFC 3164)].

[id="ocp-4-4-networking"]
=== Networking

[id="ocp-4-4-sctp-on-ocp"]
==== Stream Control Transmission Protocol (SCTP) on {product-title}

SCTP is a reliable message based protocol that runs on top of an IP network. If
your cluster is installed on bare metal infrastructure, you can enable SCTP on
the hosts in the cluster. When enabled, you can use SCTP as a protocol with both
Pods and Services.

//For more information, see
//../networking/using-sctp.adoc#using-sctp[Using the Stream Control Transmission Protocol (SCTP) on a bare metal cluster].

[id="ocp-4-4-storage"]
=== Storage

[id="ocp-4-4-persistent-storage-csi-snapshots"]
==== Persistent storage using CSI snapshots

You can now use the Container Storage Interface (CSI) to create, restore, and delete a volume snapshot. This feature is enabled by default in Technology Preview.

[id="ocp-4-4-persistent-storage-csi-cloning"]
==== Persistent storage using CSI cloning

You can now use the Container Storage Interface (CSI) to clone storage volumes after they have already been created. This feature is enabled by default in Technology Preview.

[id="ocp-4-4-scale"]
=== Scale

[id="ocp-4-4-scale-cluster-maximums"]
==== Cluster maximums

Updated guidance around
xref:../scalability_and_performance/planning-your-environment-according-to-object-maximums.adoc#planning-your-environment-according-to-object-maximums[Cluster
maximums] for {product-title} {product-version} is now available.

The {product-version} tested maximum for the number of Pods per node is 500.

Use the link:https://access.redhat.com/labs/ocplimitscalculator/[{product-title}
Limit Calculator] to estimate cluster limits for your environment.

[id="ocp-4-4-notable-technical-changes"]
== Notable technical changes

{product-title} 4.4 introduces the following notable technical changes.

[id="ocp-4-4-unsupported-features"]
=== Unsupported features

[id="ocp-4-4-oc-secrets-subcommands"]
==== OpenShift CLI secrets subcommands

The following `oc secrets` subcommands that were deprecated in {product-title}
3.9 are no longer available:

* `new`
* `new-basicauth`
* `new-dockercfg`
* `new-sshauth`

You must use the `oc create secret` command instead.

[id="ocp-4-4-oc-build-logs-command"]
==== OpenShift CLI build-logs command

The `oc build-logs` command was deprecated in {product-title} 3.11 and has been
removed. You must use `oc logs` instead.

[id="ocp-4-4-deprecated-features"]
=== Deprecated features

[id="ocp-4-4-oc-config-flag"]
==== OpenShift CLI config flag

The `--config` flag used with `oc` is deprecated. You should start using the
`--kubeconfig` flag instead.

[id="ocp-4-4-oc-timeout-flag"]
==== OpenShift CLI timeout flag

The `--timeout` flag used with `oc rsh` is deprecated. You should start using
the `--request-timeout` flag instead.

[id="ocp-4-4-oc-editor"]
==== OpenShift editor

The `OS_EDITOR` is deprecated. Users should start using `KUBE_EDITOR` or
`EDITOR` instead.

[id="ocp-4-4-machinecidr-network-param"]
==== machineCIDR network parameter

The `machineCIDR` network parameter used in the `install-config.yaml` file is
now deprecated. You should use `machineNetwork.cidr` instead.

[id="ocp-4-4-deprecation-of-operatorsources"]
==== Deprecation of OperatorSources, CatalogSourceConfigs, and packaging format

OperatorSources and CatalogSourceConfigs are deprecated from OperatorHub. The
following related APIs will be removed in a future release:

* `operatorsources.operators.coreos.com/v1`
* `catalogsourceconfigs.operators.coreos.com/v2`
* `catalogsourceconfigs.operators.coreos.com/v1`

The Operator Framework's current packaging format is also being deprecated, to
be replaced by a new bundle format in a future release.

*Upcoming new Operator bundle format and `opm` CLI*

[IMPORTANT]
====
The following features are not currently supported on {product-title} 4.4 or
intended for production use. They are highlighted here to notify users of an
important upcoming change to the Operator Framework. Limited documentation is
available at this time.
====

Related to the removal of OperatorSources and CatalogSourceConfigs, Operator
Lifecycle Manager (OLM) will be introducing a new _Operator bundle_ format in a
future release of {product-title}. A bundle is a container image that stores
Kubernetes manifests and metadata associated with an Operator and is meant to
present a specific version of an Operator.

When writing an Operator, the new bundle format requires two directories named
`manifests` and `metadata`:

----
/
├── manifests
│   ├── etcdcluster.crd.yaml
│   └── etcdoperator.clusterserviceversion.yaml
└── metadata
    └── annotations.yaml
----

In addition, the new Operator Package Manager (`opm`) is introduced alongside
the new Operator bundle format. The `opm` CLI tool can:

- generate bundle annotations,
- build bundle images, and
- validate bundle images available in a registry.

See the upstream `operator-framework/operator-registry` project repository for
documentation on these upcoming features:

- link:https://github.com/operator-framework/operator-registry/blob/master/docs/design/operator-bundle.md[Operator Bundle Overview]
- link:https://github.com/operator-framework/operator-registry/blob/master/README.md[Operator Registry README]

See the project's *Releases* page for `opm` downloads:

- link:https://github.com/operator-framework/operator-registry/releases[Releases]

[id="ocp-4-4-service-catalog-deprecated"]
==== Service Catalog, Template Service Broker, Ansible Service Broker, and their Operators

Service Catalog, Template Service Broker, Ansible Service Broker, and their
associated Operators were deprecated in {product-title} 4.2 and will be removed
in a future {product-title} release. If they are enabled in 4.3, the web console
now warns the user that these features are still enabled.

The following alerts can be viewed from the *Monitoring* -> *Alerts* page and
have a *Warning* severity:

* `ServiceCatalogAPIServerEnabled`
* `ServiceCatalogControllerManagerEnabled`
* `TemplateServiceBrokerEnabled`
* `AnsibleServiceBrokerEnabled`

The following related APIs will be removed in a future release:

* `.servicecatalog.k8s.io/v1beta1`
* `.automationbroker.io/v1alpha1`
* `.osb.openshift.io/v1`

[id="ocp-4-4-bug-fixes"]
== Bug fixes

[id="ocp-4-4-technology-preview"]
== Technology Preview features

Some features in this release are currently in Technology Preview. These
experimental features are not intended for production use. Note the
following scope of support on the Red Hat Customer Portal for these features:

link:https://access.redhat.com/support/offerings/techpreview[Technology Preview
Features Support Scope]

In the table below, features marked *TP* indicate _Technology Preview_ and
features marked *GA* indicate _General Availability_. Features marked as *-*
indicate that the feature is removed from the release or deprecated.

.Technology Preview Tracker
[cols="4",options="header"]
|====
|Feature |OCP 4.2 |OCP 4.3 |OCP 4.4

|Prometheus Cluster Monitoring
|GA
|GA
|GA

|Precision Time Protocol (PTP)
|-
|TP
|

|CRI-O for runtime Pods
|GA
|GA
|GA

|`oc` CLI Plug-ins
|TP
|TP
|

|Service Catalog
|GA
|-
|

|Template Service Broker
|GA
|-
|

|OpenShift Ansible Service Broker
|GA
|-
|

|Network Policy
|GA
|GA
|GA

|Multus
|GA
|GA
|GA

|New Add Project Flow
|GA
|GA
|GA

|Search Catalog
|GA
|GA
|GA

|Cron Jobs
|GA
|GA
|GA

|Kubernetes Deployments
|GA
|GA
|GA

|StatefulSets
|GA
|GA
|GA

|Explicit Quota
|GA
|GA
|GA

|Mount Options
|GA
|GA
|GA

|System Containers for Docker, CRI-O
|-
|-
|

|Hawkular Agent
|-
|-
|

|Pod PreSets
|-
|-
|

|experimental-qos-reserved
|TP
|TP
|

|Pod sysctls
|GA
|GA
|GA

|Central Audit
|-
|-
|

|Static IPs for External Project Traffic
|GA
|GA
|GA

|Template Completion Detection
|GA
|GA
|GA

|`replicaSet`
|GA
|GA
|GA

|Clustered MongoDB Template
|-
|-
|

|Clustered MySQL Template
|-
|-
|

|ImageStreams with Kubernetes Resources
|GA
|GA
|GA

|Device Manager
|GA
|GA
|GA

|Persistent Volume Resize
|GA
|GA
|GA

|Huge Pages
|GA
|GA
|GA

|CPU Pinning
|GA
|GA
|GA

|Admission Webhooks
|GA
|GA
|GA

|External provisioner for AWS EFS
|TP
|TP
|

|Pod Unidler
|TP
|TP
|

|Node Problem Detector
|TP
|TP
|

|Ephemeral Storage Limit/Requests
|TP
|TP
|

|Descheduler
|-
|-
|TP

|CephFS
|TP
|TP
|

|Podman
|TP
|TP
|

|Kuryr CNI Plug-in
|TP
|GA
|GA

|Sharing Control of the PID Namespace
|TP
|TP
|

|Manila Provisioner
|TP
|TP
|

|Cluster Administrator console
|GA
|GA
|GA

|Cluster Autoscaling
|GA
|GA
|GA

|Container Storage Interface (CSI)
|GA
|GA
|GA

|Operator Lifecycle Manager
|GA
|GA
|GA

|Red Hat OpenShift Service Mesh
|GA
|GA
|GA

|"Fully Automatic" Egress IPs
|GA
|GA
|GA

|Pod Priority and Preemption
|GA
|GA
|GA

|Multi-stage builds in Dockerfiles
|GA
|GA
|GA

|OVN-Kubernetes Pod network provider
|TP
|TP
|

|HPA custom metrics adapter based on Prometheus
|TP
|TP
|

|Machine health checks
|TP
|GA
|GA

|Persistent Storage with iSCSI
|TP
|GA
|GA

|Raw Block with iSCSI
|TP
|GA
|GA

|Raw Block with Cinder
|-
|TP
|TP

|OperatorHub
|GA
|GA
|GA

|Three-node bare metal deployments
|TP
|TP
|

|SR-IOV Network Operator
|TP
|GA
|GA

|Helm CLI
|-
|TP
|GA

|Service Binding
|-
|TP
|

|Log forwarding
|-
|TP
|

|User workload monitoring
|-
|TP
|

|OpenShift Serverless
|TP
|TP
|

|Compute Node Topology Manager
|-
|TP
|

|CSI volume snapshots
|-
|-
|TP

|CSI volume cloning
|-
|-
|TP

|====

[id="ocp-4-4-known-issues"]
== Known issues

* When LDAP and HTPasswd identity providers are both configured, a user cannot
log in with HTPasswd if the LDAP query takes more time than the allowed
request timeout. Even when a user exceeds the LDAP request timeout, the HTPasswd
identity provider credentials should be used. The login process succeeds if the
order of HTPasswd and LDAP identity provider usage is reversed.
(link:https://bugzilla.redhat.com/show_bug.cgi?id=1806620[*BZ#1806620*])

* There is an issue with the Machine Config Operator (MCO) supporting Day 2
proxy support, which describes when an existing non-proxied
cluster is reconfigured to use a proxy. The MCO should apply newly configured
proxy CA certificates in a ConfigMap to the {op-system} trust bundle; this is
not working. As a workaround, you must manually add the proxy CA certificate to
your trust bundle and then update the trust bundle:
+
----
$ cp /opt/registry/certs/<my_root_ca>.crt /etc/pki/ca-trust/source/anchors/
$ update-ca-trust extract
$ oc adm drain <node>
$ systemctl reboot
----
+
(link:https://bugzilla.redhat.com/show_bug.cgi?id=1784201[*BZ#1784201*])
